workflows:
  android-workflow:
    name: Android Workflow
    environment:
      vars:
        FCI_KEYSTORE_PATH: /tmp/release.key.jks
        FIREBASE_TOKEN: Encrypted(Z0FBQUFBQmdCczBJX2doQm04aUlwNDEwanJlU3gtWDFYTkEtdkxTUkNuYlJxVlBYNjhUTTNtQzZFQjl2SjdGZDdKWXNQTHV4YkZnVjg0YlQzdWFHczRyVWZtMm1BazFZaWJXbFh4OF9pWF82a2k0Z0t4QWNRbUt2SlhIczhVYjR2clRBTVBFNU5iNDNRXzdSVTFyQURWa3JBbWljWW5fM2pwTUdBSXU4T0pyUnpfNWUzZWxZOTRWai02bmZ5blE0UVgtMGpJa0UzbFA1ZFAtU2FGckVQNW1ybU90UXhXc3hhZz09)
        ANDROID_FIREBASE_CONFIG: Encrypted(Z0FBQUFBQmdCc1M3NHdmc1dzaHFtcTFjSzB1ekVqZW5EbFQ1SW8tLVF2bURya0YyNi1NOEZXVWxyY2NKdlhpeUNtS1pwRm1kQTZuZENfVDBaNkxyc0hUcW9DOTNZVndJemZTaU1nNHg0b2hwUzVyZUVuZUlKQWpfMlhvQkIxM0wzeGxtM1pkMV9wV0E5TlRzcjBObGV3aVV2QWNjV0Y2bVcyU25paDlxc2VYMC1TNzEtV3N5blJFdEhqcUg2VThtdmxpNTNQcVNuSHBFSTdDRnJDak9rXzB0ZHcxT2F5Nl9qemRhRHduRlVua3dzQzJqaVlrcHRNVGZrcnZLdmF2Skc5eGUwdXJOREM0OWpLMEVHUy0zbExBZG52YWlRVjhENUJuV2U2UERMeTVfNGY5RGVINGdPOWk3YU5FSE44TGJkSzlXVWxUTERYdlhxU0dPZ3pFQjEwcEszaHlnRFBVcXFJenR5U3FHZVNvT2JhTVdlVTRST19ZbmJndTVwSTlRUDN4SHlyb2JjbGNadmhETnY4M1RRdDJzQzlTQnNNa0xfTHJqVlEtSUZaUEd3aEVTVzFmX2tvTGxwanJYYkYwaFBUNHdKREpKN0FYOU5vU2ZzbmVEbmttaHVwTU1xYVctRUJqMW5FS1lLQXRaVlVodmI2Z29ydDVIU0NTZ1dOM2NpMFdLTUFITHJqM2NHQWdPY0lzcWtFYTRfbmZxWnptSi1WU1hFTE04Tl9CQ20tWjItLVNrcExCaG1aVkRMTm1MMndoOVVwYVBYaFhlWkw4OGlqVmNaelhVVGxDVzh1dThxQXhaWGRZTjZkb2FZTjJQdzFyLTZNWEVGRG4xRmw3Vl9VbThKc2NpajVHVjVObHh0WFhSSm9Pa1JIOENLN0JyUnhCM1dKUEI3cmZwR2NSVFhPRjNPV1N1a1JKa3VHa1hMQjBKcnl4VHduVVZqWXdLcy1uaFQ2ejFXTWxPVlhvTURKWGFfS1pWdnZ5M29HeFlsY1c0ZnRlRERSOWJWb3NabWNOcFI3QURLSVo1QUh0bG9wNUx3ajN4R3BLdzB5MWNTdFNpX3h2TndTZG1PNlRud2prMk5ZM1RvOS1tNVgwV1BOWjVmR2ZjM0hiOEUxWXVHb0pDU0NOT2tVbGhMZUo3bkdMU3JENG5xbER4emNPMUM2LUxyTUZwZnJLRXNyQXM3NVhCZm01TTVRYV9wYzUxTFdZXzBwSUVBTFRvdm1rU3V1bUFWUHlMeWlIRVRQb2V6TExDZWIxVG5xaUpaWWlxcjY3VEphNzlmR3NXM1o5QVlGZmJhdGpNQzVuelBjblgyS2FPTzc0VnNuSExBWEkwWndsTjk2bWprdVBXUUFuQlBkMXhHTXZGVWd5M1NjTEhIQVF3TEZ0ZjBIbTRzcTl4bHZSc3lIVVFyU3A4RGdkdDhuU2lHQlRzdUhIQzJWVXFQUnJ0OTh1VlhFdWFpdHNkcU5BU2JKV3pUemFEYVVOT1JEbnZIQ2k5M1IzMG1uMk50Tk9DcTlBeWFCOTRMZWxybUtZbTMyeUh2WndjRTBSM3hFdUFzTFN5RjdpZ0JMUHgwU21qVFhhSFZwSF9tRXkzZHpqX1hmc0I2cGxKdTNGd1BCazc1ZVdFSmg3R2xzVmM0OVdsYkVXSGJxOWVySUN5WFpwaXZ3S1VZOC12UzlOdkUzdjNteENyOExQMENhcE1zYzE4SXY0d0tjRmEzNVdTc2prNmJjNUc5M25qR1BaanBxZTVNdlE0UGgyaFBSajBjRzZnUUJfTGdFajNSM2R2VFdmaXBVRTZLVzJLZkt1VzFrQl8xY0NqSjFjQUgxZ2VGS3ZHeGRtT29BLW9zbkxNdHk4Y05zd1AwU3FkMWdmdmQwcUhHaWx4a1dBdEZiLXpqN1JXUHZKV0RQLUF4Zmg1dEJkYjBsWVZlWGE0OFFrZ181aFlvQ282SG9CSUZKaGNPWmFSSmNTaF95NGd0WHVTZlZDV09EbWNmclhhTXJfcXdmTmdkb0NIRFZaV1lRckxQT1pMekRwdUZia190aERoV1c4SVRjLVRyS2I4QnNqa3BPSkRvc0s4aU85cmZ2M3VxV1ZSdUZYTDFCX1J6TThzNkItZW5pSGlTcWx0N18weC1ERHlpMGp5dXlabkRoNVNkbXpPU1FmX2hyRS16VGtldUtWUHowb1FuMlJVRTAySXdERzAzcmhoRFNjTmZkYU5sREtBUnh3VDc4NEoyOUkwUmJTVlh4ME1NLXJ2dFNlQzRTN3lGNXpYaGJGNGMyajVQT2VNbzZQcnNONjlWUGJBVkVUU3dvTXRTeDRFRWo4MDdVX1djekZ5NUVneTh4SlQyUlRnaWFsc1dUYWRoUVVmYzROa1Q1d2ZKTEpsMU9rUURRN1lLRE5Fa1dOOENZb2VWS184c1NIRkZYV1NkNVdqUTZ1UTd5UUtOY05Mcnljc1FJMGxwNVpHNnRUSHBtUjhZWDZwODJubHlNYkdKRFhZR05DUHROVlU4eUF6NW5LTG1qSXNNYnY2VWNlMnJieFRsSHJqRE9sOVhRQmw5S0hDMkRRY2tEUzQtcUFDR0dYb2xYVUcwTmNMQXdYb1JYT0cwckR4RnQyTWhVbjZGTTdTUy03dloxQ2E2d0N5emRtME1iMF9JQkNMNDBEQVR6bWY0dFJEaXd1STdOZWpGanY2aV9vcGVGalF2ZmNKNG1RbVBuU2NWQTZMcVpsSHRQUVVkaXV0QlZkZEo4ZXhMY3lJRThMMGNaUkJ0c3BRM0F2Q1VtV3B6YUJJMlZzQ3lDOWNxblcyYklsQm1yX2habmtmTmdlTEptSGIxb21leUUwQ1Nyc3JXQmNzSzFDb3FkTE1yalNVUnV3WnNBNVpob0gwUjlWMU52RlZoVVZ2QVlTM2p1el92M1gtRGxFNEMxVVlaNk4xZEZwVVBqbGJoRVpOT2p6SllYRTRVUVo4c2VLNGwxaEhTNHNaX0pyaVpXV2hRUktlZjFIbXAxWTktUUYxMTFWZGc3Zk9zOVBrbEpVdF9tS0JGVEtydkRMRDJCZjBHcElGNFFlMlFGV2wtZWJPSDBsV3ZBZV9Zck1vRXlMS2U3ZjJNTHdzUVRpMm83XzNCU1ZBUXM3RVMzbTB6dWpnRkZSM19JQnI2SmVfYTBsdG5Dc1hfeEZrMXZVN3c0QjFlTGRzTm1WTWhpQVotNC1ibVc0NU9pRFJtWHVKeDBKZDZIZDB2ckk9)
        FCI_KEYSTORE: Encrypted(Z0FBQUFBQmdBcllzUlBTOExGeXZNNWpWektaa0tYa1kyWFFYR09fYV95UkZiRVY0VFQxZkR6b0EyZjVNVjBjc29LSU96eTlKY044Z0VzMlo3cEVRbUhYa1FkNTFQYWYzWElvQmpYVndyM1ByOU8zN1diaGttd2s2WGJYeFBnTUZZckF0R29OVHZXdk4tQVFJN2h5WkNnTmxRemVzWFlISThLNTVHRWJERldrTWphRzU1TWN4YUNxRFI1bWh1S1RON21iN1pISWYtY3p2RHlPdDhTeHJtMVQtQkVhZ1NSTjlzc2o1UGlPVlpOQ1BkdFlyY2dCVHlxTVdGcS1UWnVpbWY3Y2t6aWNBcElRRnRsd0x5QjRBaExJM2JsTlV1dF9SRS1WQ1dDYmFVSjJ0WGZaYUJ5Rm54dWpOUVF4ZWVFNEFneFpPTmNVNHB6OS1mUGI1N0laUG5NZi1IMWZmZng1clBkVGplR0NuVDkySnFTdWRDTUpJdnQ2dnFydFhHa1lQZU4wVTFlQVRybjlJcUh5S2JfSDY0TU8ydHBiMnpEa1JyLTV0aDFFcXh0aXJnRF85VWlUaktDSGE5cjR0MEp5ZEo5eVJtdlEzeHl1Wmd3T21mZ1dUTUt5U3FWZVFHM2dTdTdoWENNX2NkM05Ldi1xSk1BOE5SSEh4RC1pbkdkRy1VUmUyUXl6WU9JU2lhTk5lMUF2VDRrUk9qTTlkZXluSTV6aFJiNjlfaEszalF6N3Z4c2RnWFUxUWNrRHYzUGc0a0lrVC13cEFoTUhmYzhSMEVpM0dXTmZWWmFKU0F0a1o3bmhUcmtXNUxqMUhyd1B5c1BGN2ItTl9hRW16dFdBYks4d05Cbl9NUjBFVjFVSURJRnFMYlBGX3c1OUlqbHlDMnpfOGMxUnRlR21EZ015VFRJYTU3cDhMRkVjTksyby1kUVhCaUpfRWVvT000UHo0aVAtMXlSVFJ3Qm5pVWJNWDFON0Z0LWRINDlWeTh2RlRfOFlURkRhbF9NemhRZ01FUGp2bEd0WDM1N3NsUEdTYkE3RWg3Q3pzZVoxUnZYZVVpSnJDODY5bTVMZW5nMGY1a0RhaWZ5azQ0NFMzS2YxeURNRVhPSjJROWRhcWh2VHhIU09KWHppQnpCQk9HMWY1cXUzTUVPU3J2VlNZYW9XUFlnSDJBYjlmVHVsWDNQVjVtLU9iOVFhVUJvWk1paG15cEhXSzJqNXFoRjQwLVRxSFZadzR5RXpXeVd2NXBpZzJZODRTci1mRURqZmlYLXZCRUpwSjNSdHQtdVpaanRUSzNkMjdxekhsaFRfb1pHSGlvVlQyaVhTMl90dU5EV0hOb1VISFJkWG0wRW8zOHNSbk5NUzlqN3hkSDBUN1ZFMmg4eXVsc2pGUkpnOURfLUdlaVY3QVhQRkk5TlhQaWhYc2RNaGl5ZUFxRG9nZnpPWlRwb3oyV0QzR1VKVE5HRHBwRnNFcnZUZi1mM21Lcjh6WEdaTk9HODY1aC04RUxmV0NYZEQ4NmlTTUpRQ1Q4UGItTlhOeC1DVHNDamZSZnhabldfbmwydlhqT2FTdmUwWVNGT1EyVWhIVVB6b0s4eHlFcjM0UHZiWnFYd0NMREdCcUk5a196UXFnU0pZMUE0RTZsYVF3NHZSMUExcUJFN1BvZXc3clV6MzJ4ZEQtR0hPR1haQlpiY19scUxHTk9fcHZFRy1aMGpEMUdmWFJmNFpTVTJMR19IcEUwd2ZHZTZ2MEZGUmJjZzhKU1h6NHJDTjh1dGVCR04yaVBsSllqMmRkRkJKemFTcnlVQ3YyblYzZ21nYzNldnZReFgyc2NEODg4ckZ4RjBEX3pFM3FWYlY0WU1rdjBENHRpcjN2U3VTcHRPZFgwUGc0NktsaVJKTVVudVZLMVRGbkhBbGVjOTlSTmxnOWw0dTNrWjBOSXA0Q19FbEc1bC1xZHFUWXI2SGg0RXp1OG9kbUNMczY5M1JjeEpHeGQ3d3dLVmxlbm0telpzeWFERnhGT2lsS1V3bGt3dWFPMWU0Vk9oT0NqdlE1VlNyeWEyYllpZzBDTk43cExoMF9hcjFFWVBtV3NtNk9adHBhZzl4em5UVHJuT0VibkhjNzA5ejh0aUFsTzlHaWJLSEpqT2ROVWxocXpwVjNjbXVFU05UbFhtUGdtMk9aNDZQTTc1VW1WRWVTaDIybkhiUExWczQxdXB6UkNMcXNrN1pXRVFpaUZmWEdvak16QVVqMGlmVVhwbXg0U3l1VkJ1bVpxMGFFTTJ4V3MyMVJiR1JOUlFyNDlhakIxdUcxbzdFWU9INU8ycXZXVVEwc3FSOFlpY3lqWkdaVnlvRzQ1U0NPcmYycFVKVTB2b3hfbjViMmdsbkNXYS1kWmpsRXhWOFJ3VU9xWUdaSU1jSEdzM3BWSW9JZUU2Vmlod1J3Tzh0SHF3ZHFsTkY5bXBpUDh0UzJodVFSYkl0LXBHRjdwN29mNjJqWGFQNGxFWFdWZ1RJMzRNeDY0emZyblpmcmNycnNfcVliTmY4M293V3Jvc2p1aEpnZ09HMWUzU0RIdjl3UnpLYWZiWmNlYUMxcUMtMXB4ZkdvNDlLanRxTzNxM093YmhKa0JqQlRIN3BEaXFSOUVBZVVZdnhfd1hGMzhTWVZmSWVhazFSZThTcHI4T1pmUkJYYVJHNzJmS19DR0MzX251UWV6Vm5hSFlTR3JMcTJGRXVjMFNkQkJ6Z0tOaWRMMVR1OEZmQklWSXJvdlpRS1AwY0V2YnY4RkFXT29hZUtvQ3oxNGdzbUR3cHVTeGkwUnF6Q0VlYVpCZzFFMFhVZEp3RkxQckpMOXBSa0NEZjZoTmJpdk44cFNsNnJxekJIbERCZGhZWXl4X1dnNVdGQ0JJMXFfdFNGVWg0SVQwX0g4enAtVklsNWZCYWdqT0NockJMMk82RXBlZjV1bU9TSHcxamNUXzJhRFljV29pNUp3OFhpYmNRekk1NjlCRGQwQVVUSnIxdWM5VUVXcFlyTlJqclVTT0xsRWZHWlZPcWZvd3VGS2I0b3kzelVYdWpiWTZiY3M1R19aX2pFcmF6SVhDclVnUW93bFN5eXFvOGNpOTZfR2JHVFo0MXFCTDdnMWh3Yl9DUGhtTFFPVmxnYWl5UmttNV9oUDNibklJcGVZVDZfNTB2TmNKbERkQXA2dXhUNUJpb0RJd0NZU0gtd21JeUd1Tk5HZmNsSC1xTUxiNkd2ckZvSE82R2JvSDl4Mk9HbWVUV0w5ODlxWnBJbG9BTlhVMVBZUTdiQ1J5MG1WcTJ6SHRJLWx0V0VhOXV2dVZNLUFqUkJSRXlyTGdUTHg2d21KWE1VVGhfczRBYnhqQXlBVHBDdFQwVmU2ZEczMGFocDE1dlNsc25FTDJpZFVpdFRLUFJlMzUwc2NxNVE4eHhUSnJKUGQzNkZBenpIR3FCR2JUYURub0pJbERqb0xPSzl1emMxWGh5QzFCY3BFcHZ3OXJNd244RDdadnliVGtlQWxycWRIaE52Z2VqRGYxWVhqbndRUm45YjN2bHJlSGFiWUh0S1J6Q3gwR1h1ZzBGbTRNWkVJSDc2M1hxcGlacGlvcVdjM0xEeVd3UlhYai1YTndqOTc1Z29zcjVNak9hSnNKYjBHUmNibERvbVhkWG1nODNVYzFJaHpQeFJaNU5kMGdEaVdNUjRZVDV0ckhsUUZCbnZrVURfRy1lLWo0RmpER3BfVk5GWEw2aGdIOEhQTnItNEJ0RE5pVjYyV3lxZTFYM3ZMRDFJdVJyRV9SR3lpa2tNQktLMGVybmdLbUpyRHkyMUNfTU9hMTFuQ3BteFY4Z2Q2VUs1b2I5aXE2N2lvWGVKYnJGM1NGV1RKNTNkSWVTeFdjRTI2OFBkeHlQZURLc204bHRaa1V3akI2MHZiY0h5UlpDcHlVVVB5MFVteVdPbHpVdUU0bXl2eFNHNmFtQlNQZ3c2NDI3ZC1pSVhMa3NxNWpkQkVfSVZ1ZXY5WXhQSU5TWVg4RkNfYVhHbmNhanU4SE1lby1EQWNTZDBzaFNNU2dRX29LSnJYekxrMHN3VlJpWHpXM3hCMWNqUkpqYndLVmtXOS1GdWctMWVUSTRaODZTY3lOT1BGcWtyS0JGQmVoaUpvZUJfTkFYWTdGQU9zYnA4MlNnVTc2VTUzQkFtZ2JnQ1B6eDRpV2hkQkdDa2t0RF8tOHF5VW1DN3FQMV9vT3J1cVBXZ2dNNlFZRS0zeUVzd0E2YlQ0eXdHd29xTzRFNmp4TW9xSE1VaS1GXzRIWmRMMVRYWXdfNHJJRHhyN2xMVUk4eGFVUkljczNOYzJzRTNHa0Vua21FczNidjNvRkJOMUV1Y3NHZWpfbmcwYjdTbGJaRkQ2X1haU1BUQm8zSGI0MXFlN3drX1Q2M3lUbWFOS1M2OUc0STk4bzF2VDBianRhaFRKWUJ6SzV3U2VaaDZqN0NOOVp1ekNhTFF0YURVRXdiRTZaNUlFVnN1OWtwSE42eG40U1EzU19QUXV2eEtYazBDbV93RVkxYndrM1VaZXlkdnZPT2hHS0VKaG51ZnkwbFhSNkxxQzl6OWFlOXB3dUJpRlY0b3I3a0RncGNQamVaaXg2dTRCWWtvQlo3SFFiNmctVVdTWHEzZTEtWmZhdm5YTUJISVlLQjlBN3o2X2F3Sk9jUzUyX3BpeTJKUXlDY3VaVWNhVXQyM3BkWU1sVGVuVGlkV3pMelpkVVVRdjFrTnpsNHJsenlvRjZLUTRJSlZnbThPbzNRZW5QaXE2REVMWHl2ckxSa0Nrc180bmJXZW9LMThaUXNfUlZjUnBDMlJqYkxBWDFhZWdtYlB2UUpzRDlRR2xJaXhLX2pBZG5VcS16MU5iWnY3Z3d2cjUwaVFhcWdNbHFERGxKSkFpWmR4eGVpc2xqUmhDMlNPVmRKQkc0bFZ0YTRlak5BRE5QOWFoQ0lla3QzUUVBRUdBenYzcDZWeWRBWDd1YlpwUmZra0QtUzVVSUQzZkFkZGF4azl6WmZRaU1YYkoybGVaV21jZGxpMXJQM1R4a3NMZkcyNUtkM1V4SE9nVEVIaTF2elp3emdYbk5VV0FOQ0dFTUZnd1hVMVdaWlpzeS0wcnhRb2pONWhOZFNxcXVWUk5QeHJJdTR0S1luQy1KX3ZnaXduVl8wLXZ3M2JRaTRnZUFBekhMRjRvT0dXZk50RkdhYWFzbFZ3T3JROHQ1ak91dUNLWEEtcUVWLWI2U2xBZHB0cHNwdExnZGRyN2VhTnRObVNGTDVQWmYxVjRHQ2pDYUdGcjFqSGI0c1Z3WDB2amdKQlhhSU1WZ3Y0YmRzaTROUUlmQUJsVTVoa0V3SGFxWE1Id1JjMkFDNW1XQWhkVEUyVW5qb0FBb2xiSjE2czZObVpjRl9Idkl5WHoxSFJlZz09) # PUT THE ENCRYPTED KEYSTORE FILE HERE
        FCI_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmdBcnFZaUxRUG1EUlBjWkg0S1I4LVI1ZU1LZGNpbTRwdkpCYWZ5N002MHc3aGZ5dUxzWE9Vd0M1c1IxNlVoSVBSVERhMEhBYVVPNzJZTDZ2d3pvc09KSDAxeFE9PQ==) # PUT THE ENCRYPTED PASSWORD FOR THE KEYSTORE FILE HERE
        FCI_KEY_PASSWORD: Encrypted(Z0FBQUFBQmdBcnFZaUxRUG1EUlBjWkg0S1I4LVI1ZU1LZGNpbTRwdkpCYWZ5N002MHc3aGZ5dUxzWE9Vd0M1c1IxNlVoSVBSVERhMEhBYVVPNzJZTDZ2d3pvc09KSDAxeFE9PQ==) # PUT THE ENCRYPTED KEYSTORE ALIAS PASSWORD HERE
        FCI_KEY_ALIAS: Encrypted(Z0FBQUFBQmdBcnpJZnFZYTc4MlJtcUhoaHYxSnNzMlNMQndQenN0YUd6Y1B3X1o2dHJyOEFfUGhYRGhRQXRGRzhHZGlrbkhDXzQ3TFJGY244djNEZThWTEZRRU03MHJjWkE9PQ==) #PUT THE ENCRYPTED KEYSTORE ALIAS HERE
      node: latest
    triggering:
      events:
        - push
        - tag
        - pull_request
      branch_patterns:
        - pattern: release
          include: true
          source: true
    scripts:
      - name: Install npm dependencies
        script: |
          set -ex
          printenv
          yarn install
      - name: Set up local properties
        script: echo "sdk.dir=$HOME/programs/android-sdk-macosx" > "$FCI_BUILD_DIR/android/local.properties"
      - name: Set up Firebase
        script: echo $ANDROID_FIREBASE_CONFIG | base64 --decode > $FCI_BUILD_DIR/android/app/google-services.json
      - name: Set up key.properties file for code signing
        script: |
          echo $FCI_KEYSTORE | base64 --decode > $FCI_KEYSTORE_PATH
          cat >> "$FCI_BUILD_DIR/android/key.properties" <<EOF
          storePassword=$FCI_KEYSTORE_PASSWORD
          keyPassword=$FCI_KEY_PASSWORD
          keyAlias=$FCI_KEY_ALIAS
          storeFile=$FCI_KEYSTORE_PATH
          EOF         
      - name: Test
        script: cd android && chmod +x gradlew && ./gradlew test
        test_report: app/build/test-results/**/*.xml         
      - name: Build Android app
        script: |
          cd android
          chmod +x gradlew
          ./gradlew assembleRelease         
      - name: Post-publish
        script: |
           cd android && chmod +x gradlew && ./gradlew assembleRelease appDistributionUploadRelease         
    artifacts:
      - android/app/build/outputs/**/**/*.apk
    